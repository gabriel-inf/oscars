<project name="javaClients" default="compile" basedir=".">

<property name="build" location="../../build/examples" />
<property name="lib" location="../../lib" />
<property name="repo" location="./repo" />
<property name="src" location="../../src" />
<property name="private" location="../../conf/private/client" />
<property name="public" location="../../conf/public" />
<property name="public.client" location="../../conf/public/client" />
<property name="url"
          value="https://oscars-dev.es.net:9090/axis2/services/OSCARS" />


<path id="client.path">
    <fileset dir="${lib}/axis2" includes="*.jar" />
    <fileset dir="${lib}" includes="*.jar" />
    <pathelement location="${build}/classes" />
    <pathelement location="." />
</path>

<target name="checkprivate">
    <available property="private.exists" file="${private}" />
</target>

<target name="copyprivate" depends="checkprivate" if="private.exists">
    <!-- Copy private material to repo -->
    <copy todir="${repo}" overwrite="true">
        <fileset dir="${private}" includes="*.*" />
    </copy>
</target>

<target name="prepare">
    <mkdir dir="${repo}/modules" />
    <mkdir dir="${build}/classes" />
    <!-- Copy public material to repo -->
    <copy todir="${repo}">
        <fileset dir="${public.client}" includes="*.*" />
    </copy>
    <copy todir="${repo}/modules">
        <fileset dir="${public}" includes="*rampart-1.1*.mar" />
    </copy>

</target>

<target name="compile-stubs" depends="prepare">
    <javac srcdir="${src}" destdir="${build}/classes">
        <classpath refid="client.path" />
        <include name="net/es/oscars/oscars/OSCARSStub.java" />
        <include name="net/es/oscars/oscars/*FaultMessageException.java" />
        <include name="net/es/oscars/oscars/ExtensionMapper.java" />
        <include name="net/es/oscars/wsdlTypes/*.java" />
        <include name="net/es/oscars/client/**/*.java" />
        <include name="net/es/oscars/PropHandler.java" />
        <include name="net/es/oscars/LogWrapper.java" />
     </javac>
</target>

<target name ="compile" depends="compile-stubs, copyprivate">
    <javac classpathref="client.path" srcdir="." destdir="${build}/classes" />
    <!-- Copy application resources -->
    <copy  todir="${build}/classes">
        <fileset dir="${repo}"
           includes="log4j.properties, sec-client.properties, sec-client.jks" />
    </copy>
</target>

<!-- create reservation test -->
<target name="createRes" depends="compile">
    <java classname="CreateReservationClient"
            classpathref="client.path" fork="true">
           <arg value="${repo}" />
        <arg value="https://oscars-dev.es.net:9090/axis2/services/OSCARS" />
    </java>
</target>

<!-- Cancel Reservation test -->
<target name="cancelRes" depends="compile">
    <condition property="params.ok">
        <and>
            <isset property="url" />
            <isset property="tag" />
        </and>
    </condition>
    <fail message="Please set the resTag parameter. Usage: CancelReservationClientt [-Durl=&lt;url&gt;] -Dtag=&lt;tag&gt;"
          unless="params.ok" />

    <java classname="CancelReservationClient"
              classpathref="client.path" fork="true">
        <arg line="${repo} ${url} ${tag}" />
    </java>
</target>

<!-- Query Reservation test -->
<target name="queryRes" depends="compile">
    <condition property="params.ok">
        <and>
            <isset property="url" />
            <isset property="tag" />
        </and>
    </condition>
    <fail message="Please set the resTag parameter. Usage: CancelReservationClientt [-Durl=&lt;url&gt;] -Dtag=&lt;tag&gt;"
          unless="params.ok" />
    <java classname="QueryReservationClient" classpathref="client.path"
            fork="true">
        <arg line="${repo} ${url} ${tag}" />
    </java>
</target>

<!-- List Reservations test -->
<target name="listRes" depends="compile">
    <java classname="ListReservationsClient" classpathref="client.path"
              fork="true">
        <arg line="${repo} ${url}" />
    </java>
</target>

<!-- forward -->
<target name="forward" depends="compile">
    <java classname="ForwardClient" classpathref="client.path" fork="true">
        <arg value="${repo}" />
        <arg value="https://oscars-dev.es.net:9090/axis2/services/OSCARS" />
        <arg value="false" />
    </java>
</target>

<target name="clean" description="Delete old build directory">
    <delete dir="${build}" />
    <delete dir="${repo}" />
</target>

</project>
