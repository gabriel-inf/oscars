<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>API &mdash; PyOSCARS v1.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '',
          VERSION:     '1.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: ''
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/interface.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="contents" title="Global table of contents" href="contents.html" />
    <link rel="index" title="Global index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="PyOSCARS v1.0 documentation" href="index.html" />
    <link rel="next" title="OSCARSNotify receiver" href="receiver.html" />
    <link rel="prev" title="Command line interface" href="cli.html" />
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="receiver.html" title="OSCARSNotify receiver"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="cli.html" title="Command line interface"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PyOSCARS v1.0 documentation</a> &raquo;</li>
      </ul>
    </div>
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  
  <div class="section" id="api">
<h1 id="api">API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<p>PyOSCARS exposes an API <a class="footnote-reference" href="#id2" id="id1">[1]</a> that you can use to build your own applications.
The <a class="reference external" href="cli.html#cli"><em>command line interface</em></a> itself uses the API, so this page might
also help you get a better understanding of how those scripts work.</p>
<p>The API can be used at two levels of abstraction, depending on what your needs
are.
Usually, you will want to use the <a class="reference internal" href="#with-models"><em>with models</em></a> approach,
since it hides most details behind its interface.</p>
<p>There are cases, however, where you need to program <a class="reference internal" href="#without-models"><em>without models</em></a>,
for example because you want more flexibility.
Also remember that, in this case, the interface you will be using is the same
models are built on top of, so it should be easy to adapt them to your needs and
regain a similar high-level interface.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Application Programming Interface</td></tr>
</tbody>
</table>
<div class="section" id="id3">
<span id="with-models"></span><h2 id="id3"><span id="with-models"></span>With models<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>The main entry point in the code is the <tt class="docutils literal"><span class="pre">ClientFactory</span></tt>.
This class instantiates client objects both for OSCARS and OSCARSNotify.</p>
<p>The client objects that the two static functions <tt class="docutils literal"><span class="pre">instantiateOSCARSClient</span></tt> and
<tt class="docutils literal"><span class="pre">instantiateOSCARSNotifyClient</span></tt> return are proxies: the methods they expose
are in fact calls to specific methods of the <tt class="docutils literal"><span class="pre">MessageBuilder</span></tt>, which turns the
arguments into a Python structure (usually a dictionary), which is then encoded
as a SOAP message and sent to the server.</p>
<p>The <tt class="docutils literal"><span class="pre">MessageBuilder</span></tt> provides a convenient interface for calling methods
without having to provide the whole Python structure, but it also limits you,
because it has to make some assumptions on what your request is about.
If you are interested in building your application without models, have a look
at the <a class="reference internal" href="#without-models"><em>Without models</em></a> section.</p>
<p>To start things off, let us get a client object for OSCARS:</p>
<div class="highlight"><pre><span class="n">client</span> <span class="o">=</span> <span class="n">ClientFactory</span><span class="o">.</span><span class="n">instantiateOSCARSClient</span><span class="p">(</span><span class="n">webServiceURL</span><span class="p">,</span>
                                               <span class="n">certFilePath</span><span class="p">,</span>
                                               <span class="n">privateKeyFilePath</span><span class="p">,</span>
                                               <span class="n">privateKeyPassword</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
<p>We can now easily call IDC methods, for example to query the status of a
reservation:</p>
<div class="highlight"><pre><span class="n">client</span><span class="o">.</span><span class="n">queryReservation</span><span class="p">(</span><span class="n">globalReservationId</span><span class="p">)</span>
</pre></div>
<p>The result is a Python dictionary containing the parsed SOAP response:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">queryReservation</span><span class="p">(</span><span class="s">&#39;anna.internet2.edu-32&#39;</span><span class="p">)</span>

<span class="go">{&#39;bandwidth&#39;: 100,</span>
<span class="go"> &#39;createTime&#39;: 1215111940,</span>
<span class="go"> &#39;description&#39;: u&#39;test&#39;,</span>
<span class="go"> &#39;endTime&#39;: 1215112140,</span>
<span class="go"> &#39;globalReservationId&#39;: u&#39;anna.internet2.edu-32&#39;,</span>
<span class="go"> &#39;login&#39;: u&#39;andy&#39;,</span>
<span class="go"> &#39;pathInfo&#39;: {&#39;layer2Info&#39;: {&#39;destEndpoint&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr1:port=1-1-1:link=1&#39;,</span>
<span class="go">                             &#39;destVtag&#39;: u&#39;3000&#39;,</span>
<span class="go">                             &#39;srcEndpoint&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr2:port=E1-1-1:link=1&#39;,</span>
<span class="go">                             &#39;srcVtag&#39;: u&#39;3000&#39;},</span>
<span class="go">              &#39;path&#39;: {&#39;_attrs&#39;: {&#39;id&#39;: u&#39;unimplemented&#39;},</span>
<span class="go">                       &#39;hop&#39;: [{&#39;_attrs&#39;: {&#39;id&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr2:port=E1-1-1:link=1&#39;},</span>
<span class="go">                                &#39;linkIdRef&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr2:port=E1-1-1:link=1&#39;},</span>
<span class="go">                               {&#39;_attrs&#39;: {&#39;id&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr2:port=1-1-12:link=10.10.3.2&#39;},</span>
<span class="go">                                &#39;linkIdRef&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr2:port=1-1-12:link=10.10.3.2&#39;},</span>
<span class="go">                               {&#39;_attrs&#39;: {&#39;id&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr1:port=1-1-12:link=10.10.3.1&#39;},</span>
<span class="go">                                &#39;linkIdRef&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr1:port=1-1-12:link=10.10.3.1&#39;},</span>
<span class="go">                               {&#39;_attrs&#39;: {&#39;id&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr1:port=1-1-1:link=1&#39;},</span>
<span class="go">                                &#39;linkIdRef&#39;: u&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr1:port=1-1-1:link=1&#39;}]},</span>
<span class="go">              &#39;pathSetupMode&#39;: u&#39;timer-automatic&#39;},</span>
<span class="go"> &#39;startTime&#39;: 1215111900,</span>
<span class="go"> &#39;status&#39;: u&#39;FAILED&#39;}</span>
</pre></div>
<p>The client object is also aware of the methods it provides and the arguments
(and the corresponding default values) they need.</p>
<p>For example, we may want to find out what methods the OSCARS client provides:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">getMethods</span><span class="p">()</span>

<span class="go">[&#39;cancelReservation&#39;, &#39;createReservation&#39;, &#39;queryReservation&#39;]</span>
</pre></div>
<p>Suppose now that we want to use <tt class="docutils literal"><span class="pre">createReservation</span></tt>, but do not know its
arguments. In this case, we can just ask:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">getArguments</span><span class="p">(</span><span class="s">&#39;createReservation&#39;</span><span class="p">)</span>

<span class="go">[(&#39;durationSecs&#39;, None),</span>
<span class="go"> (&#39;bandwidth&#39;, None),</span>
<span class="go"> (&#39;desc&#39;, None),</span>
<span class="go"> (&#39;srcEndpoint&#39;, None),</span>
<span class="go"> (&#39;destEndpoint&#39;, None)]</span>
</pre></div>
<p>As you can see, <tt class="docutils literal"><span class="pre">getArguments</span></tt> returns a list of 2-tuples, where the first
element of the tuple is the name of the argument, and the second is its default
value, or <tt class="xref docutils literal"><span class="pre">None</span></tt> if the argument has no default value.</p>
</div>
<div class="section" id="id4">
<span id="without-models"></span><h2 id="id4"><span id="without-models"></span>Without models<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Programming without models is slightly more difficult than what we saw so far,
because it involves writing manually the Python structures that are then turned
into SOAP messages.</p>
<p>I will present a brief code example and comment it shortly:</p>
<div class="highlight"><pre><span class="k">from</span> <span class="nn">wssecurity</span> <span class="k">import</span> <span class="n">SignatureHandler</span>
<span class="k">from</span> <span class="nn">ZSI.ServiceProxy</span> <span class="k">import</span> <span class="n">ServiceProxy</span>

<span class="n">signatureHandler</span> <span class="o">=</span> <span class="n">SignatureHandler</span><span class="p">(</span><span class="n">certFilePath</span><span class="p">,</span> <span class="n">privateKeyFilePath</span><span class="p">,</span>
                                                  <span class="n">privateKeyPassword</span><span class="p">)</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">ServiceProxy</span><span class="p">(</span><span class="n">wsdlPath</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">webServiceURL</span><span class="p">,</span>
                  <span class="n">sig_handler</span><span class="o">=</span><span class="n">signatureHandler</span><span class="p">)</span>

<span class="n">req</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;startTime&#39;</span><span class="p">:</span> <span class="mf">1218698957</span><span class="p">,</span>
    <span class="s">&#39;endTime&#39;</span><span class="p">:</span> <span class="mf">1218699017</span><span class="p">,</span>
    <span class="s">&#39;bandwidth&#39;</span><span class="p">:</span> <span class="mf">100</span><span class="p">,</span>
    <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Test&#39;</span><span class="p">,</span>
    <span class="s">&#39;pathInfo&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;pathSetupMode&#39;</span><span class="p">:</span> <span class="s">&#39;user-xml&#39;</span><span class="p">,</span>
        <span class="s">&#39;layer2Info&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;srcEndpoint&#39;</span><span class="p">:</span> <span class="s">&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr2:port=E1-1-1:link=1&#39;</span><span class="p">,</span>
            <span class="s">&#39;destEndpoint&#39;</span><span class="p">:</span> <span class="s">&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr1:port=1-1-1:link=1&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">print</span> <span class="n">sp</span><span class="o">.</span><span class="n">createReservation</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</pre></div>
<p>As you can see, instantiating the client code is still fairly easy.
What is more cumbersome is the definition of the request, which must follow the
XML Schema for the message <a class="footnote-reference" href="#id6" id="id5">[2]</a>.</p>
<p>My suggestion is to start from the simpler messages the <tt class="docutils literal"><span class="pre">MessageBuilder</span></tt> can
provide you with, and extend them:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">MessageBuilder</span><span class="o">.</span><span class="n">buildCreateReservationMessage</span><span class="p">(</span><span class="mf">60</span><span class="p">,</span> <span class="mf">100</span><span class="p">,</span> <span class="s">&#39;Test&#39;</span><span class="p">,</span> <span class="s">&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr2:port=E1-1-1:link=1&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="s">&#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr1:port=1-1-1:link=1&#39;</span><span class="p">)</span>

<span class="go">{&#39;bandwidth&#39;: 100,</span>
<span class="go"> &#39;description&#39;: &#39;Test&#39;,</span>
<span class="go"> &#39;endTime&#39;: 1218699017,</span>
<span class="go"> &#39;pathInfo&#39;: {&#39;layer2Info&#39;: {&#39;destEndpoint&#39;: &#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr1:port=1-1-1:link=1&#39;,</span>
<span class="go">                             &#39;srcEndpoint&#39;: &#39;urn:ogf:network:domain=anna.internet2.edu:node=anna-vlsr2:port=E1-1-1:link=1&#39;},</span>
<span class="go">              &#39;pathSetupMode&#39;: &#39;user-xml&#39;},</span>
<span class="go"> &#39;startTime&#39;: 1218698957}</span>
</pre></div>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[2]</a></td><td>The client knows this, and will prevent you from sending malformed
messages.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3>Table Of Contents</h3>
            <ul>
<li><a class="reference external" href="">API</a><ul>
<li><a class="reference external" href="#id3">With models</a></li>
<li><a class="reference external" href="#id4">Without models</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="cli.html" title="previous chapter">Command line interface</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="receiver.html" title="next chapter">OSCARSNotify receiver</a></p>
            <h3>Quick search</h3>
            <form class="search" action="search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="receiver.html" title="OSCARSNotify receiver"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="cli.html" title="Command line interface"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PyOSCARS v1.0 documentation</a> &raquo;</li>
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright Gianluca Campanella.
      Last updated on Aug 14, 2008.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
    </div>
  </body>
</html>