<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
</head>
<body>
<h2>Tomcat Configuration</h2>
<big style="font-weight: bold;">$CATALINA_HOME/conf</big>
<ul>
  <li> server.xml - defines standalone Tomcat server - service name is
Catalina <br>
  </li>
  <ul>
    <li>the connector elements define the port(s) on which tomcat
will
listen the protocol (http or https), and the location of the keystore
for
https connectors.</li>
    <ul>
      <li> define a dumper valve here</li>
      <li> define remoteAddrValve here to limit the sites that can
access the connector</li>
    </ul>
  </ul>
  <li> web.xml- defines default values for servlets for static
resources, jsp, server-side-includes we just used the sample in the
distribution.</li>
  <li> context.xml - used distribution sample</li>
  <li> logging.properties - can be edited to change some logging levels</li>
  <li> tomcat-users.xml - user names and passwords for access to the
Tomcat administrative web pages</li>
</ul>
<h3>$CATALINA_HOME/common</h3>
Classes and libraries shared by the Tomcat server and all the
webapps.&nbsp;
We added common/classes/log4j.properties and common/lib/log4j.jar in
order to get Tomcat to do log4j. By default it just uses commons
logging. The logging by the oscars.war and oscars.aar pick up defaults from this
file, e.g the root.catagory log. <br>
<h3>$CATALINA_HOME/shared</h3>
Contains classes and libraries shared by all the webapps but not the
Tomcat server. This has been where we have put files that can't seem to
be found from the axis2.war or the OSCARS.aar. Currently the contents
are:<br>
<ul>
  <li>classes/repo - files that need to be on the classpath as repo/&lt;filename&gt;
     <ul>
        <li>sec-client.jks
        <li>sec-client.properties - says the keystore file is in repo/sec-client.jks
        </ul>
  <li>classes/net/es/oscars/client/security/PWCallback.class - used by
the OSCARS when forwarding a request.</li>
  <li>oscars.conf
    <ul>
      <li>axis2.repo (<span style="font-style: italic;">used when
OSCARS is forwarding a request</span>, see <a href="#server-client">below</a>)
        <ul>
          <li>axis2.xml  - says the signaturePropFile  is in repo/sec-client.properties</li>
          <li>ssl-keystore.jks</li>
          <li>modules</li>
          <ul>
            <li>rampart.mar<br>
            </li>
          </ul>
        </ul>
      </li>
      <li>server
        <ul>
          <li>oscars.key </li>
          <li>oscars.properties </li>
          <li>oscars_juniper_lsp_teardown.xml</li>
          <li>oscars_juniper_lsp_setup.xml</li>
          <li>pss.key<br>
          </li>
          <li>test.properties</li>
        </ul>
      </li>
    </ul>
  </li>
  <li> lib&nbsp; contains the axis2 and rampart jars.<br>
  </li>
</ul>
<h3>$CATALINA_HOME/webapps</h3>
Contains all the user provided war files. In our case this is
OSCARS.war and
axis2.war. When a war file is put in this directory it will be
automatically deployed by the Tomcat server and its contents will be
extracted into a directory with the name of the war. <br>
Every tomcat webapp has a WEB-INF/web.xml that defines the service name
and methods.
<h3>$CATALINA_HOME/bin - startup scripts</h3>
<ul>
<li>startup.sh - we edited to set OSCARS_HOME <br>
and JAVA_OPTS="-Djava.net.preferIPv4Stack=true" to get around a FreeBSD 6.0 / ipv6/ jdk1.5 bug
<li>catalina.sh - starts the comand with output sent to $CATALINA_HOME/logs/catalina.out
</ul>
<h2>Axis2 Configuration</h2>
<ul>
  <li>$CATALINA_HOME/webapps/axis2/WEB-INF/web.xml<br>
    <ul>
      <li> defines servlets, e.g SOAPMonitor. AdminServlet,Axis2Servlet</li>
      <li>maps urls to servlet names, and servlet names to class</li>
    </ul>
  </li>
  <li>$CATALINA_HOME/webapps/axis2/WEB-INF/conf/axis2.xml<br>
    <ul>
      <li>Defines parameters like enableMTOM, username, password (for
axis admin)</li>
      <li> defines messageRecievers, transportReceivers(http, tcp, smtp</li>
      <li>Engage global modules like SOAPMonitor and rampart</li>
      <li> defines phase order (added soapMonitor phase)</li>
    </ul>
  </li>
</ul>

<h2>OSCARS Configuration</h2>
<h2>Server</h2>
<ul>
  <li>OSCARS.jar/META-INF/<span style="font-weight: bold;">services.xml</span>
is generated by WSDL2Java and specifies all the methods and parameters.
The security inFlow and outFlow parameters need to be added to this
file. The&nbsp; name of the sec-properties file is given here. </li>
  <li>classes/<span style="font-weight: bold;">sec-server.properties</span>
names the keystore file and has its
password</li>
  <li>classes/<span style="font-weight: bold;">sec-server.jks</span>
has
the keystore that is used by rampart to
verify signed messages. It only needs to contain the trustedCaCerts for
the issuers of any user who will submit a signed message.</li>
  <li>Files copied from OSCARS to axis2</li>
  <ul>
    <li>need the oscars version of log4j.properties to be in
webapps/axis2/classes</li>
    <li>need&nbsp; to copy wss4j.jar, xalan.jar and xmlsec.jar to
webapps/axis2/lib,</li>
    <li>wss4j.jar must not be in OSCARS.war or OSCARS.aar, or it causes
class conflicts.</li>
  </ul>
</ul>
<h2><a name="Server-client">Server acting as client</a></h2>
When the server forwards a request to another domain, it acts as a
OSCARS/axis2 client and thus needs to include te client-side
configuration files. These files are put into
$CATALINA_HOME/shared/oscars.conf/axis2.repo. 
<p>The location of the axis2.xml  file  and 
the repository in which the modules are found are set in Forwarder.setup. 
Forwarder.setup calls KeyMangement.setKeyStore which sets the ssl keystore to the
file "ssl-keystore.jks" in the repository directory. 
<p>
axis2.xml defines the names of the signatureProperty file and the keystore.
<p>
The files sec-client.properties, sec-client.jks and ssl-keystore.jks are also
copied to $CATALINA_HOME/shared/classes/repo so that they will be on
the server's classpath.<br>
<br>
<h2>Client</h2>
See <a href="keystore.html">Security Reference</a> for more
details about these files.<br>
<ul>
  <li><span style="font-weight: bold;">axis2.xml</span> - needed when
signing messages. It contains:</li>
  <ul>
    <li>InFlow and OutFlow parameters</li>
    <li>Name of the client-properties file</li>
  </ul>
  <br>
The axis2.xml file can be found by the client code from a
javavm flag -daxis2.xml=&lt;filename&gt; <br>
or can be set programatically by <br>
  <pre>ConfigurationContext configContext = <br>		ConfigurationContextFactory.createConfigurationContextFromFileSystem(repo, null);<br>ServiceClient serviceClient = new ServiceClient(configContext, null)</pre>
Where <b>repo</b> is a directory on the classpath that contains a
conf/axis2.xml file.<br>
  <br>
The repo directory also conatins: <li><span style="font-weight: bold;">sec-client.properties</span>
contains:
    <ul>
      <li>org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
      </li>
      <li>org.apache.ws.security.crypto.merlin.keystore.type=jks </li>
      <li>org.apache.ws.security.crypto.merlin.keystore.password=password
      </li>
      <li>.apache.ws.security.crypto.merlin.file=sec-client.jks (name
of keystore file)</li>
    </ul>
  </li>
  <li><span style="font-weight: bold;">sec-client-key.jks</span>
contains</li>
  <ul>
    <li>keyentry for the user specified in axis2.xml to be signing
the outgoing messages</li>
    <li>trustedCaCerts for the issuer of this user's certificate <br>
    </li>
  </ul>
  <li><span style="font-weight: bold;">ssl-keystore.jks </span>- has
the certificate and issuer for the ssl
certificate of the oscars services to which the client will be
connecting </li>
</ul>
</body>
</html>
