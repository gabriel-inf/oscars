<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>OSCARS Database Notes</title>
  <link rel="stylesheet" href="styleSheets/oscars.css" type="text/css">
  <link rel="shortcut icon" href="images/esnet.ico" type="image/x-icon">
</head>
<body>
<!--#include virtual="header.html" -->
<div id="topBar" class="topBar">
<div class="topBarDiv"> &nbsp; <a href="index.html">home</a> &gt; <a
 href="dependencies.html">Dependencies</a> &gt; <a href="database.html">Database</a>
</div>
</div>
<h2>Database Use</h2>
<h3>Overview</h3>
<p>We are currently using Hibernate 3.3 to persist data objects.
Hibernate hides a multitude of details
at the JDBC level, including conversion of data types in queries and
result sets, and transaction handling.
In addition, from the <a href="http://www.hibernate.org">Hibernate</a>
Web page:</p>
<quote>
"Hibernate is a powerful, high performance object/relational
persistence and query service. Hibernate lets you
develop persistent classes following object-oriented idiom - including
association, inheritance, polymorphism,
composition, and collections."
</quote>
<p>The underlying database server is <a href="http://dev.mysql.com">MySQL</a>.
Currently we are using version 5.0.
The MySQL server is set up to only accept connections from the
machine it is running on, for security reasons. It depends on the
presence of a Web server on the
same machine to forward requests to it. All requests are authenticated
and authorized via the AAA
before being passed on to Hibernate and the database.<br>
</p>
<p><span style="font-weight: bold;"><a name="initialAct"></a>Installing
MySQL<br>
</span>If you already have a version of MySQL 4.1 or later, you should
not need to install another version. However, we are currently using
the latest 5.0 version if you wish to update.<br>
</p>
<p>Go to <a
 href="http://dev.mysql.com/downloads/mysql/5.0.html#downloads">MySQL
5.0 downloads</a> and chose the distribution for your platform.
Download and install it per the instructions that are included with the
distribution.&nbsp; The installation will be intially set up with
grants for all privileges on *.* root@localhost, with grant option
where root has no password set, and two anoymous user@localhost
accounts with more restricted access. You will want to add a passwords
for these accounts. Instructions on how to set the passwords or delete
accounts can be found at <a
 href="http://dev.mysql.com/doc/refman/5.0/en/default-privileges.html">MySQL
<span style="font-weight: bold;"></span>Securing the Initial MySQL
Accounts.</a><br>
For a Unix system the following will work. <br>
</p>
<pre><code>shell&gt; <strong>mysql -u root</strong><br>mysql&gt;<strong> SET PASSWORD FOR ''@'localhost' = PASSWORD('<em>newpwd</em>');</strong><br>mysql&gt; <strong>SET PASSWORD FOR ''@'<em>host_name</em>' = PASSWORD('<em>newpwd</em>');<br></strong>mysql&gt; <strong>SET PASSWORD FOR 'root'@'localhost' = PASSWORD('<em>newpwd</em>');</strong><br>mysql&gt; <strong>SET PASSWORD FOR 'root'@'<em>host_name</em>' = PASSWORD('<em>newpwd</em>');</strong></code></pre>
where host_name is replaced by your local host name, i.e the results of
the hostname command, which should also be the result of the following
mysql query.<br>
<br>
<code>&lt;mysql&gt; <strong>SELECT host,user FROM mysql.user;<br>
<br>
</strong></code>During the installation of OSCARS the intall.sh script
will ask for the name of the mysql privileged user and its password
when it is going to create the databases and tables needed by OSCARS.
You should give it the user <span style="font-style: italic;">root</span>
and the password you have just set.<br>
<br>
<h3>Database schema set up and population</h3>
Note: the do_build.sh script now creates the aaa, bss, testaaa
and
testbss databases; creates the bss and ass tables; and populates the
aaa tables with default values for institutions, resources, permissions
and attributes.&nbsp; There are command line scripts in tools/utils to
add and delete users, institutions (org) and domains (in the bss
database).<br>
<br>
OSCARS makes use of two databases,
one for the AAA named "<span style="font-style: italic;">aaa</span>",
and one for the BSS, pathfinder, PSS and
TSS, named "<span style="font-style: italic;">bss</span>". The
Hibernate configuration information for these databases is in <code>conf/server</code>,
in the
files <code>aaa.cfg.xml</code> and <code>bss.cfg.xml</code>,
respectively. These are copied to the appropriate place in the
classpath as part of the build process.
<p>The scripts to create the necessary tables in the aaa and
bss
databases are contained in
<code>sql/aaa/createTables.sql</code> and <code>sql/bss/createTables.sql</code>,
respectively. <code>sql/aaa/populateDefaults.sql</code> is a sample
script
setting up default attributes, resources, and permissions.</p>
<p>The program to populate the bss database with the network
topology
for ESNet is located in
<code>tools/updatedb/TopologyUpdater.java</code>. It depends on the
presence of a directory with previously gathered
information about each router in the topology, which was gained using
SNMP queries. Currently the
format of the files in that directory is ESnet-specific.<br>
</p>
<p>There is a similar program in <code>tools/updatedbterce/TERCETopologyUpdate.java</code>
that will populate the bss database from the TERCE web service.<br>
</p>
<h3>Test databases</h3>
<p>Separate test databases, <span style="font-style: italic;">testaaa</span>
and <span style="font-style: italic;">testbss</span>, are set up for
unit tests. Make sure that they are created as well as the aaa and bss
databases. They are repopulated as necessary
each time a test suite executes. Their Hibernate configuration
files are in the
<code>conf/server</code> directory, <code>testaaa.cfg.xml </code>and <code>testbss.cfg.xml</code>.
These are identical to the
production configuration files except for the names of the databases.</p>
<h3>Object/relational mapping</h3>
<p>Each table in the database has a corresponding Java bean.
The
mapping is defined in the Hibernate
configuration files mentioned above. There is also a Hibernate
configuration file that maps each field
in the table to a bean property, with a suffix of ".hbm.xml", located
in the same directory as the bean.</p>
<p>OSCARS makes extensive use of the
<a href="http://www.hibernate.org/328.html">DAO</a> (data-access
object) design pattern.
Each bean, for example <code>Router.java</code>, has an associated DAO
object, in this case <code>RouterDAO.java,</code>
that performs low-level CRUD (create, retrieve, update, delete)
operations. Each DAO object sub-classes
<code>src/net/es/oscars/database/GenericHibernateDAO.java</code>.
</p>
<h3>Useful MySQL commands</h3>
<code>shell&gt; <strong>mysql -u &lt;username&gt; -p</strong></code>&nbsp;
prompts for a password and starts mysql<br>
<code>mysql&gt; <strong> show status;</strong></code> shows the status
of a number of variables.<br>
<code>mysql&gt; <strong>show databases;</strong></code> &nbsp;shows
what
databases are available<br>
<code>mysql&gt; <strong>connect &lt;database&gt;;</strong></code>
&nbsp;connects
you to the
specified database<br>
<code>mysql&gt; <strong>show tables;</strong></code> &nbsp;shows all
the tables
in the database<br>
<code>mysql&gt; <strong>describe &lt;table&gt;;</strong></code>
&nbsp;shows the
fields of the
specified table<br>
<code>mysql&gt; <strong>select * from &lt;table&gt;;</strong></code>
&nbsp;shows
all the rows of
the specified table.<br>
<p>For the rest of the iceberg see <a href="http://dev.mysql.com/doc/">MySQL
documentation</a>.<br>
</p>
<!--#include virtual="footer.html" -->
</body>
</html>
