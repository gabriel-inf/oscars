<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Subversion Notes</title>
  <base href="/docs">
  <link rel="stylesheet" href="styleSheets/oscars.css" type="text/css">
  <link rel="shortcut icon" href="images/esnet.ico" type="image/x-icon">
</head>
<body>
<!--#include virtual="header.html" -->
<div id="topBar" class="topBar">
<div class="topBarDiv"> &nbsp;
<a href="index.html">home</a> &gt; <a href="SVNRepository.html">SVN
Repositories</a>
&gt; <a href="subversion.html">Subversion Notes</a>
</div>
</div>
<h2>Notes on using Subversion</h2>
<h3>Setting up the domain-specific repository</h3>
<p>Each domain needs to set up a repository for domain-specific and
private
information. For Subversion, the following example shows how to set up
a
repository accessible via Apache. The following lines need to be filled
in and
placed
in httpd.conf:</p>
<pre><location><br>    DAV svn<br>    SVNPath /path/to/repo<br>    AuthzSVNAccessFile /path/to/svn-access-file<br>    Require valid-user<br>    AuthType Basic<br>    AuthName "Domain-specific and private information"<br>    AuthUserFile /path/to/svn-auth-file        <br></location>
</pre>
<p>The following is an example svn-access-file:</p>
<pre>[groups]<br>oscars_developers = chin, davidr<br>oscars_user = oscars<br><br>[esnet:/]<br>@oscars_developers = rw<br>@oscars_user = r<br></pre>
<p>For ESnet, esnet is the name of the repository. It has the following
file structure:</p>
<pre>esnet<br>    domain<br>        branches<br>        tags<br>        trunk<br>            client<br>            server<br></pre>
<p>The files in client and server are copied over from the oscars
repository
from conf/examples and filled in with domain-specific values.</p>
<p>The domain directory was inserted in the path in order to have a
string that
will
appear in all paths, and can be used in the Subversion post-commit
hook.
Following is the post-commit hook used for ESnet (note that the
svnnotify
setup is actually all one line)</p>
<pre>#!/bin/sh<br><br>REPOS="$1"<br>REV="$2"<br><br>/usr/local/bin/svnnotify -r $REV -C -d -H HTML::ColorDiff -p $REPOS \ <br>    --subject-prefix OSCARS_ESnet_Commit: --to-regex-map 'dwrobertson@lbl.gov \<br>    chin@es.net'=\^domain --reply-to dwrobertson@lbl.gov \<br>    --svnlook=/usr/local/bin/svnlook &gt; /tmp/xxx-svnlog 2&gt;&amp;1<br>echo $1 &gt;&gt; /tmp/xxx-svnlog<br>echo $2 &gt;&gt; /tmp/xxx-svnlog<br></pre>
<h3>Merging revisions from a branch into the trunk</h3>
<p>
You may want to merge all the changes on the branch or just the changes
within
a single directory. There does not seem to be a way to just merge a
single file.
</p>
<p>1. Make sure you have a clean copy of the trunk, or at least the
directory in
which your changes reside.</p>
<pre>    % cd<trunk working="" directory=""> subdirectory<br>    % svn status<br></trunk></pre>
<p>should show nothing. e.g no <filename>.</filename></p>
<p>2. Check when the last revision to the trunk/directory was made:</p>
<pre>   % svn info<br></pre>
<p>returns trunkrevnumber as "Last Changed Rev".</p>
<p>3. The svn merge command we are using is</p>
<pre>    % svn merge sourceURL1[@N] sourceURL2[@M] [WCPATH]<br></pre>
<p>The source URLs are specified at revisions N and M. These are the
two
sources to be compared. The differences are merged into the WCPATH
which is
your trunk working directory and defaults to ".". The revisions default
to
HEAD if omitted. In our examples the M defaults to the HEAD.</p>
<p>3a. For example, to merge the entire branch:</p>
<pre>    % svn merge https://oscars.es.net/repos/oscars/branches/java/@4691 \<br>                https://oscars.es.net/repos/oscars/branches/java/<br></pre>
<p>3b. To merge just the files in the docs directory:</p>
<pre>    % cd docs<br>    % svn merge https://oscars.es.net/repos/oscars/branches/java/docs/@4691 \<br>                https://oscars.es.net/repos/oscars/branches/java/docs/<br></pre>
<p>4. For complicated merges, do a dry run, and save the resulting
list.
It may be long and you may need it to find conflicts.</p>
<pre>    % svn merge --dry-run https://oscars.es.net/repos/oscars/branches/java/@4691 \<br>            https://oscars.es.net/repos/oscars/branches/java/ &gt; ~/svn.list<br></pre>
<p>5. To do the actual merge from the branch (in this case
branches/java) to
your working directory:</p>
<pre>    % svn merge https://oscars.es.net/repos/oscars/branches/java/@4691 \<br>                https://oscars.es.net/repos/oscars/branches/java/<br></pre>
<p>Note that no changes have been made to the repository yet.</p>
<p>6. Check for any conflicts, these will be marked by a 'C' before the
filename. In this example, validator.js has a conflict that we will
have to
manually resolve:</p>
<pre>    U    web/index.html<br>    C    web/js/validator.js<br></pre>
<p>After resolving this conflict do:</p>
<pre>    % svn resolved web/js/validator.js<br></pre>
<p>Then, test with a deploy of the aar and war files on the server.</p>
<p>7. Commit the changes in the working copy of the trunk:</p>
<pre>    % svn commit<br></pre>
<!--#include virtual="footer.html" -->
</body>
</html>
