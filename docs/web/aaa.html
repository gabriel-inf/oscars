<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>AAA Component Notes</title>
  <link rel="stylesheet" href="styleSheets/oscars.css" type="text/css">
  <link rel="shortcut icon" href="images/esnet.ico" type="image/x-icon">
</head>
<body>
<!--#include virtual="header.html" -->
<div id="topBar" class="topBar">
<div class="topBarDiv"> &nbsp; <a href="index.html">home</a> &gt;
Components &gt; <a href="aaa.html">Authentication and Authorization</a>
</div>
</div>
<h1>AAA Component Notes</h1>
The Authentication, Authorization and Accounting component is
responsible authenticating a requestor against the list of registered
users and for providing the methods to check that this user is allowed
to perform the actions that are requested. It also provides the methods
for
managing users and their attributes. At this point it does no
accounting. The authorization policy that is being implemented is
described in <a href="authorizationPolicy.html">Authorization Policy</a>.<br>
<h2>External interfaces</h2>
<b>Web<br>
</b> User connects to https://oscars.es.net/OSCARS/ and sees a login
page.<br>
Logs in with oscars login name e.g. mrthompson@lbl.gov and password<br>
If the name is found in the users table and the password is correct, he
receives two cookies, one that contains a hash that
indexes this user in the user table and one  which is used
to determine what tabs will be displayed on the next web page the user
sees.
<br>
<pre>    servlets.UserSession<br><br>            String checkSession(PrintWriter out, HttpServletRequest request) - <br>	 	if there is userName cookie in the request, returns the userName from the cookie.<br>		Otherwise returns an xml error message.<br><br>             void setCookie(String cookieName, String cookieValue, HttpServletResponse response)<br>		includes the cookie in the servlet repsonse.<br><br>             String getCookie(String cookieName, HttpServletRequest request)<br>         	called by servlets.UserSession.checkSession and servlets.Utils.tabSection<br>         	If there is a userName cookie, uses the value of the cookie to determine user's login name<br>         	Otherwise returns null. <br></pre>
<br>
<b>API</b><br>
All messages are digitally signed by an X.509 priviate key and the
corresponding certificate is included in the message. To do this set
the signatureKeyIdentifier to DirectReference in the client side
axis2.xml file. Other message creators may do it differently but the
request message should include a wsse:Security element in the header
which inlcudes a wsse:BinarySecurityToken that contains the
base64-encoded certificate. This element is referenced by the
wsse:SecurityTokenReference element in the ds:KeyInfo in the
ds:Signature. <br>
(note:
wsse==http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd
ds==http://www.w3.org/2000/09/xmldsig#)
<p> For each message the axis2 rampart module verifies the signature on
the message using the enclosed certificate. It also validates the
certificate as being signed by one of the trust anchors (CAs) stored in
its keystore. So far we trust the DOEGrids CA, the ESnet Root CA 1, the
ESnet SSL Server Certificates CA, the DCS Test CA, the JRA3_Prototype
CA,
the nortel CA, and the OASIS interop CA.
Once the message has been validated the corresponding method:
create,cancel,list,query in OSCARSSkeleton is called. Each method
starts out with a checkUser call which first calls setOperationContext <br>
</p>
<pre>   <br>     oscars.OSCARSSkeleton<br><br>     	private void  setOperationContext() - called by checkUser<br>          extracts the users DN and issuers DN from the message context  which are then <br>          stored in private variables within the OSCARSSkeleton.<br><br>     	String checkUser() <br>          Calls setOperationContext and checks that a certificate was found. This should only  fail if<br>          the axis2/rampart configuration is wrong.<br>          Then calls userManager.loginFromDN to check if the DN is entered in the user table and to get the <br>          login name which is used for subsequent authorization.<br> </pre>
<h2>Internal interfaces:</h2>
<pre>aaa/UserManager<br>       String LoginFromDN(String DN)   <br>		called from OSCARSSkeleton.checkUser<br>       		uses UserDAO to lookup DN and return login name<br><br>       String verifyLogin(String userName, String password)<br>		called from servlets.AuthenticateUser.doGet<br>       		uses UserDAO to see if user is already authenticated<br>       		if not, looks up login Name and enrypted password and <br>		compares to input password<br><br>       AuthValue checkAccess(String userName, String resourceName,<br>                                    String permissionName)<br>                called by<br>                      servlets(AuthenticateUser,CancelReservations,QueryReservations,ListReservations,<br>				UserAdd,userAddForm,UserModify,UserQuery,UserRemove)<br>                      OSCARSSkeleton.listReservations,queryReservations,cancelReservation,<br>				createPath,refreshPath,teardownPath,<br>                            	getNetworkTopology,initiateTopologyPull)<br>                 verifies that this user has the specified permission to the specified resource<br>                 gets userid, resourceid and permissionid from the appropropriate tables<br>                 queries authorization table based the the userid, resourceid and permissionid tuple.<br><br>	AuthValue checkModResAccess(String userName, String resourceName, String permissionName,<br>		           int reqBandwidth, int reqDuration, boolean specPathElems, boolean specGRI)<br>		called by<br>                     servlets(CreateReservationForm,createReservation,createReservationform)<br>			    OSCARSSkelton.createReservation<br><br>       	also contains the methods to create, query, list and delete users.<br>     <br>     </pre>
<h2>Internal Data Structures</h2>
<pre><b>UserManger</b>
            private LogWrapper log;
            private String salt;
            Session session;  
            From HibernateUtil.getSessionFactory("aaa").getCurrentSession();
<br>
<b>aaa.User</b> contains all the items in the <span style="font-weight: bold;">user table</span>  with get and set methods
    Integer id;              /** identifier field */
    String login;            /** persistent field */
    String certIssuer;       /** nullable persistent field, issuer of user's X509 certificate*/
    String certSubject;      /** nullable persistent field, subject of user's X509 certificate*/
    String lastName;         /** persistent field */
    String firstName;        /** persistent field */
    String emailPrimary;     /** persistent field */
    String phonePrimary;     /** persistent field */
    String password;         /** nullable persistent field */
    String description;      /** nullable persistent field */
    String emailSecondary;   /** nullable persistent field */
    String phoneSecondary;   /** nullable persistent field */
    String status;           /** nullable persistent field, not currently used */
    String activationKey;    /** nullable persistent field, not currently used */
    Long loginTime;          /** nullable persistent field */
    String cookieHash;       /** nullable persistent field */
    Institution institution; /** persistent field */
<br>
<b>aaa.Authorization</b>  contains the items from the <span style="font-weight: bold;">authorizations table</span> with get and set methods
    Integer id;             /** identifier field */
    Attribute attribute;    /** persistent field */
    Resource resource;      /** persistent field */
    Permission permission;  /** persistent field */
    Constraint constraint;  /** nullable persistent field */
    String constraintValue; /** nullable persistent field */
<br>
 <b>aaa.Resource</b>  contains the items from the <span style="font-weight: bold;">resources table</span> with get and set methods
    Integer id;             /** identifier field */
    String name;            /** persistant field */
    String description;     /** persistant field */
<br> 
<b>aaa.Permissions</b>  contains the items from the <span
 style="font-weight: bold;">permissions table</span> with get and set methods
    Integer id;             /** identifier field */
    String name;            /** persistant field */
    String description;     /** nullable persistent field */</pre>
<br>
<br>
<!--#include virtual="footer.html" -->
</body>
</html>
