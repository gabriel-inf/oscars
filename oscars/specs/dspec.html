<html>
<title>OSCARS Reservation Manager Design Specification</title>
</head>
<body>
<h2>OSCARS Reservation Manager Design Specification</h2>

<h3>Year 2 Update (DRAFT)</h3>

<em>David Robertson, Chin Guok</em><br/>
ESnet<br/><br/>

August 30, 2005</br>

<hr>

<h3>Introduction</h3>

<p>This document focuses on the design decisions made for implementing
the <a href="fspec.html">requirements</a> for the reservation manager
(RM) portion of <a href="http://www.es.net/oscars">OSCARS</a>.
A parenthesized indicator following a feature description shows the year of
the project the feature was or will be completed.</p>

<p>Portions of this document are taken from the OSCARS
<a href="http://www.es.net/oscars/documents/OSCARS.pdf">project summary</a>.
Specifications have been updated based on lessons learned from the 
initial year-one implementation.</p>

<p>Design specifications take into account the fact that security is absolutely 
essential.  The impact of an abuse could be very
large.  A DoS attack could prevent reservations from being processed.  If the
service is compromised, the WAN may be disabled.  During the following
discussion of the RM's components, security implications are postponed
until the final section.</p>

<br/>

<h3>Grid Service Components</h3>

<p>The primary design decision was to implement the authentication,
authorization, and accounting subsystem (AAAS) and bandwidth scheduler
subsystem (BSS) components as Grid services.  Web services (WS) standards
are/will be used wherever possible, including SOAP for transport (y1),
WSDL for service descriptions (y2), and SAML for security assertions (y2).</p>

<p>The BSS, while implemented as a Grid service, is only
accessible via its associated AAAS.  The AAAS and BSS do not necessarily have
to run on the same machine.  The path setup subsystem (PSS) is implemented as a
module linked in by the BSS. (y1)</p>

<p>Different instances of the RM, for example in
different organizations, will communicate via their respective AAAS's through 
the setup of federated trust (y2/y3).</p>

<br/>

<h3>Transport</h3>

<p><a href="http://www.w3.org/TR/soap/">SOAP</a> messages are used for
communication between all OSCARS components except the PSS.  Identical SOAP
messages to the AAAS will be generated, whether using the manual interface (y1)
or an API (y2).  The Perl SOAP::Lite package is used by clients to
make SOAP calls, and by servers to dispatch them. (y1)</p>

<p>Grid component services will be described via the Web Service Definition
Language (<a href="http://www.w3.org/TR/wsdl">WSDL</a>).  WSDL provides for
definitions of data types for message arguments using XML Schema, and
definitions of request and response messages. (y2)</p>

<br/>

<h3>Database</h3>

<p>The MySQL database server is used.  The database organization (tables,
fields, etc.) used the BRUW database as a starting point.  Securing
the database server is discussed in the final section.</p>

<br/>

<h3>AAAS</h3>

<p>The AAAS consists of an Apache2 Web server, a Perl SOAP::Lite server, 
a MySQL database server, and a front end to that database consisting of a set 
of Perl packages (y1).</p>

<p>Requests are dispatched using SOAP.  If a request requires AAAS 
functionality, the front end accesses and/or modifies the AAAS's database based
on that request.  If it requires BSS functionality, the AAAS front end forwards 
that request to the BSS front end. (y1)</p>

<p>Requests made via the API will use the same service description as the CGI 
scripts to send messages to the AAAS front end (y2).</p>

<br/>

<h3>BSS</h3>

<p>The BSS consists of a Perl SOAP::Lite server, a MySQL database server, and 
a Perl front end to that database.  It also includes a Perl package to 
determine the 
route to set up within ESnet, and a scheduler package which runs as a separate 
thread.  SOAP requests are only accepted from the AAAS. (y1)</p> 

<p>Reservations are identified by unique tags which are generated by 
concatenating a user's email address, the date and time, and the
primary key of the reservation in the BSS database.</p>

<p>The scheduler thread periodically polls the database to see if 
reservations have become current, in which case the PSS library is called to 
set up the label-switched path (LSP).  The thread also polls to see if a 
reservation has expired, at which point a call is made to the PSS library to 
tear down the LSP. (y1)</p>

<p>In the future, the BSS will use an open-source library (TBD)
to handle calendaring in conjunction with the AAAS MySQL database, and
databse triggers to invoke LSP set up and tear down (y2).

<br/>

<h3>PSS</h3>

<p>The PSS uses 
<a href="http://www.juniper.net/support/junoscript/">Junoscript</a>
to configure Juniper routers (y1), and will use
<a href="http://www.shrubbery.net/rancid/">RANCID</a> (y2)
to configure Cisco routers.  The PSS
sets up the LSP, checks for non-valid paths, and tears down the LSP (y1).</p>

<br/>

<h3>User interface and CGI</h3>

<p>The manual user interface to the RM is a Web-Based User Interface (WBUI),
i.e., a browser.  The specific mode of interaction is via CGI forms.  The forms
used the
<a href="http://http://discvenue.internet2.edu/wordpress/">BRUW</a>
Web pages as the starting point for the interface design and necessary 
functionality.
(BRUW is an experimental Internet2 bandwidth reservation system.)
All forms have three areas:  a banner area, a status area, and a
main area for the primary functionality, with navigation tabs at its top.
(y1)</p.

<p>Before requests can be made via the WBUI, the user must go to an initial
login form to authenticate via their email address and password.  Before
login, no forms are accessible to the user except the initial login form .
(y1)</p>

<p>Alternatively, a distinguished name (DN) could be used as a login.
The DN could be used to retrieve a certificate or token
from the <a href="http://doegrids.org/">DOEGrids Certificate Service</a> (y2).
</p>

<p>Once a user has been authenticated and submits a form, SOAP::Lite methods 
are used to handle user requests (y1).

<p>Database access is not done directly via CGI scripts.  Instead, SOAP calls
are made from these scripts to the AAAS.
In year 2, CGI functionality may be replaced by Java servlets (TBD). 
</p>

<p>If an error occurs during the processing of a user request, a SOAP
faultstring is returned to the CGI script which made the SOAP call.  This
error message is displayed in the status area, and the main area is
unchanged.  If no error occurred, new information is displayed in the main
area depending on which form was submitted. (y1)</p>

<p>The <a href="http://www.sve.man.ac.uk/Research/AtoZ/ILCT">WSRF::LITE</a>
API will be used by client application programs.  WSRF::Lite is a
Perl implementation of the
<a href="http://www.oasis-open.org/specs/index.php">WS-Resource</a>
Web services framework (y2).</p>

<br/>

<h3>Security</h3>

<p>The Apache2 Web server is used, and only accepts connections
via SSL.   Currently it only accept connections from ESnet hosts.
httpd processes run as an unprivileged user without a login shell. (y1)</p>

<p>The only way to access the database servers is via SOAP 
calls to the AAAS front end.  The AAAS database server only accept requests
from a database front end, running on the same machine.  The BSS and its 
associated database are only accessible via the AAAS front end.</p>

<p>Signed SOAP messages are used in all instances (y2).</p>

<p>The database runs as an unprivileged user without a login shell.  It only 
accepts requests from clients running on the same machine (i.e. the front end).
MySQL is configured with the --skip-networking option to ensure this. (y1)</p>

<p>The RM will use ESnet production tools to monitor usage (y2).</p>


</body>
</html>


